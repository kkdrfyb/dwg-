/* Tooltip Container */
#animTooltip {
    position: fixed;
    pointer-events: none;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    padding: 15px;
    border-radius: 12px;
    z-index: 9999;
    width: 280px;
    display: none; /* Toggled by JS */
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.2s, transform 0.2s;
    text-align: center;
}

#animTooltip.visible {
    opacity: 1;
    transform: translateY(0);
    display: block;
}

/* Dark Mode Adaptation */
[data-theme="dark"] #animTooltip {
    background: rgba(30, 30, 30, 0.95);
    border-color: #444;
}

.anim-desc {
    margin-top: 10px;
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.4;
}

.anim-stage {
    height: 80px;
    position: relative;
    background: var(--bg-hover);
    border-radius: 8px;
    overflow: hidden;
    display: flex; /* Center content */
    align-items: center;
    justify-content: center;
}

/* ================== Common Shapes ================== */
.a-file, .a-sheet, .a-cell {
    position: absolute;
    box-sizing: border-box;
}

.a-file {
    width: 20px;
    height: 26px;
    background: #4CAF50;
    border-radius: 3px;
    width: 24px;
    height: 32px;
}
.a-file::before {
    content: '';
    position: absolute;
    top: 0; right: 0;
    border-width: 0 8px 8px 0;
    border-style: solid;
    border-color: rgba(255,255,255,0.5) #fff; 
}

.a-sheet {
    width: 30px;
    height: 20px;
    background: #fff;
    border: 2px solid #2196F3;
    border-radius: 2px;
}

.a-row {
    width: 30px; 
    height: 6px; 
    background: #FF9800; 
    border-radius: 2px; 
    margin: 2px 0;
}

.a-arrow {
    font-size: 20px;
    color: #666;
}

/* ================== 1. Merge Workbooks (File -> Folder/File) ================== */
.anim-wb .f1 { animation: flyIn1 2s infinite; background: #66bb6a; left: 20px; top: 24px; }
.anim-wb .f2 { animation: flyIn2 2s infinite; background: #43a047; left: 20px; top: 24px; }
.anim-wb .f3 { animation: flyIn3 2s infinite; background: #2e7d32; left: 20px; top: 24px; }
.anim-wb .target { 
    right: 40px; 
    width: 34px; height: 44px; 
    background: #1565C0; 
    animation: pulse 2s infinite; 
    display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;
}

@keyframes flyIn1 { 0%{transform: translate(0,0); opacity:0;} 20%{opacity:1;} 80%{transform: translate(140px, 0) scale(0.5); opacity:0;} 100%{opacity:0;} }
@keyframes flyIn2 { 0%{transform: translate(-30px, -20px); opacity:0;} 30%{opacity:1;} 80%{transform: translate(170px, 20px) scale(0.5); opacity:0;} 100%{opacity:0;} }
@keyframes flyIn3 { 0%{transform: translate(-30px, 20px); opacity:0;} 40%{opacity:1;} 80%{transform: translate(170px, -20px) scale(0.5); opacity:0;} 100%{opacity:0;} }
@keyframes pulse { 0%, 70% {transform: scale(1);} 80% {transform: scale(1.1);} 100% {transform: scale(1);} }

/* ================== 2. Merge to Sheet (Stacking) ================== */
.anim-stack .row1 { animation: stack1 2s infinite; top: 10px; left: 10px; background: #FF9800; }
.anim-stack .row2 { animation: stack2 2s infinite; top: 30px; left: 10px; background: #FFC107; }
.anim-stack .row3 { animation: stack3 2s infinite; top: 50px; left: 10px; background: #FF5722; }
.anim-stack .base { 
    right: 50px; top: 20px; 
    width: 40px; height: 50px; 
    background: white; border: 2px solid #ccc; 
    display: flex; flex-direction: column; padding: 2px;
}

@keyframes stack1 { 0%{transform:translate(0,0);opacity:1;} 50%{transform:translate(120px, 5px);} 100%{transform:translate(120px, 5px);opacity:0;} }
@keyframes stack2 { 0%{transform:translate(0,0);opacity:1;} 60%{transform:translate(120px, -5px);} 100%{transform:translate(120px, -5px);opacity:0;} }
@keyframes stack3 { 0%{transform:translate(0,0);opacity:1;} 70%{transform:translate(120px, -15px);} 100%{transform:translate(120px, -15px);opacity:0;} }

/* ================== 3. Internal Merge (Sheets -> Sheet) ================== */
.anim-internal .s1 { animation: sMerge1 2s infinite; left: 20px; top: 30px; border-color: #E91E63; }
.anim-internal .s2 { animation: sMerge2 2s infinite; left: 50px; top: 30px; border-color: #9C27B0; }
.anim-internal .target { right: 40px; border-color: #3F51B5; background: #E8EAF6; }

@keyframes sMerge1 { 0%{transform: translateX(0);} 100%{transform: translateX(110px); opacity: 0; } }
@keyframes sMerge2 { 0%{transform: translateX(0);} 100%{transform: translateX(80px); opacity: 0; } }

/* ================== 4. Same Name (A+A -> A) ================== */
.anim-same .f1 { left: 20px; top: 20px; animation: sameFlow 2.5s infinite; }
.anim-same .f1::after { content:'A'; color:white; font-size:10px; position:absolute; bottom:2px; left:8px; }
.anim-same .f2 { left: 60px; top: 20px; animation: sameFlow 2.5s infinite 0.5s; background: #66bb6a; }
.anim-same .f2::after { content:'A'; color:white; font-size:10px; position:absolute; bottom:2px; left:8px; }
.anim-same .res { right: 40px; top:20px; background: #1565C0; display:flex; justify-content:center; align-items:center; color:white; width: 40px; }
.anim-same .res::after { content:'A(All)'; font-size:8px; }

@keyframes sameFlow { 0%{opacity:0; transform: translateY(10px);} 20%{opacity:1;} 80%{transform: translate(100px, 0); opacity:0;} 100%{opacity:0;} }

/* ================== 5. Same Position (Cell -> List) ================== */
.anim-pos .grid { 
    width: 30px; height: 30px; 
    display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap:1px; background:#ccc;
    position: absolute; left: 20px;
}
.anim-pos .grid div { background: white; }
.anim-pos .grid .target-cell { background: #f44336; animation: cellExtract 2s infinite; }

.anim-pos .list {
    right: 40px; width: 40px; height: 50px; background: white; border: 1px solid #999;
    display:flex; flex-direction:column; align-items:center; padding: 2px;
}
.anim-pos .item {
    width: 80%; height: 6px; background: #EF5350; margin: 2px 0; opacity:0;
    animation: listAppear 2s infinite 0.5s;
}

@keyframes cellExtract { 0%{transform: scale(1);} 50%{transform: scale(1.5); z-index:10;} 100%{transform: translate(120px, 0) scale(0.5); opacity:0;} }
@keyframes listAppear { 0%{opacity:0;} 50%{opacity:1;} 100%{opacity:1;} }

/* ================== 7. Dynamic (Puzzle) ================== */
.anim-dyn .p1 { 
    width: 20px; height: 20px; background: #00BCD4; 
    position: absolute; left: 30px; top: 30px;
    clip-path: polygon(0% 0%, 100% 0%, 100% 80%, 70% 80%, 70% 100%, 30% 100%, 30% 80%, 0% 80%);
    animation: puzzleLeft 2s infinite;
}
.anim-dyn .p2 { 
    width: 20px; height: 20px; background: #FFC107; 
    position: absolute; right: 30px; top: 30px;
    clip-path: polygon(30% 0%, 70% 0%, 70% 20%, 100% 20%, 100% 100%, 0% 100%, 0% 20%, 30% 20%);
    animation: puzzleRight 2s infinite;
}
@keyframes puzzleLeft { 0%{transform:translateX(0);} 50%{transform:translateX(30px);} 100%{transform:translateX(0);} }
@keyframes puzzleRight { 0%{transform:translateX(0);} 50%{transform:translateX(-30px);} 100%{transform:translateX(0);} }

/* ================== 8. Collab (Conflict) ================== */
.anim-clb .u1 { left: 20px; top: 10px; background: #2196F3; animation: clash1 2s infinite; }
.anim-clb .u2 { left: 20px; top: 50px; background: #4CAF50; animation: clash2 2s infinite; }
.anim-clb .res { 
    right: 50px; top: 25px; width: 30px; height: 30px; 
    border: 2px solid #aaa; display:flex; align-items:center; justify-content:center;
    font-size: 16px;
}
.anim-clb .res::after { content:''; animation: showConflict 2s infinite; }

@keyframes clash1 { 0%{transform: translate(0,0);} 50%{transform: translate(120px, 15px);} 100%{opacity:0;} }
@keyframes clash2 { 0%{transform: translate(0,0);} 50%{transform: translate(120px, -15px);} 100%{opacity:0;} }
@keyframes showConflict { 
    0%, 40% { content: ''; background:transparent;} 
    50% { content: '!'; color: red; font-weight: bold; } 
    100% { content: '!'; color: red; } 
}
