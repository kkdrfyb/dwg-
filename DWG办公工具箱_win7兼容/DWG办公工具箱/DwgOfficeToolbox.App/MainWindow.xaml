<Window x:Class="DwgOfficeToolbox.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DwgOfficeToolbox.App"
        mc:Ignorable="d"
        Title="DWG 办公工具箱" Height="900" Width="1300"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResizeWithGrip"
        Background="#F5F7FA">
    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Background" Value="#4F46E5"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#4338CA"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#3730A3"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#E5E7EB"/>
                                <Setter Property="Foreground" Value="#9CA3AF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="#E5E7EB" 
                                BorderThickness="1" 
                                CornerRadius="12"
                                Padding="20">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <ContentPresenter Grid.Row="1"/>
                                <TextBlock Grid.Row="0" 
                                           Text="{TemplateBinding Header}" 
                                           FontWeight="SemiBold" 
                                           FontSize="16" 
                                           Foreground="#1F2937"
                                           Margin="0,0,0,16"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Background" Value="White"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Background" Value="White"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal">
                            <Grid Width="20" Height="20">
                                <Border x:Name="Border" 
                                        CornerRadius="4" 
                                        BorderBrush="#E5E7EB" 
                                        BorderThickness="2" 
                                        Background="White"/>
                                <Path x:Name="CheckMark" 
                                      Width="12" 
                                      Height="12" 
                                      Stretch="Fill" 
                                      Fill="#4F46E5" 
                                      Data="M 3 8 L 7 12 L 15 3" 
                                      Stroke="#4F46E5" 
                                      StrokeThickness="2" 
                                      StrokeLineJoin="Round" 
                                      Visibility="Collapsed"/>
                            </Grid>
                            <ContentPresenter Margin="12,0,0,0" 
                                              VerticalAlignment="Center" 
                                              TextBlock.FontSize="14" 
                                              TextBlock.Foreground="#374151"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="Border" Property="BorderBrush" Value="#4F46E5"/>
                                <Setter TargetName="Border" Property="Background" Value="#EEF2FF"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="#4F46E5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowHeight" Value="40"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#F3F4F6"/>
            <Setter Property="VerticalGridLinesBrush" Value="#F3F4F6"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="ColumnHeaderHeight" Value="44"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGrid">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8">
                            <ScrollViewer x:Name="DG_ScrollViewer" Focusable="false">
                                <ScrollViewer.Template>
                                    <ControlTemplate TargetType="ScrollViewer">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <DataGridColumnHeadersPresenter x:Name="PART_ColumnHeadersPresenter" 
                                                                            Grid.Column="1" 
                                                                            Visibility="{Binding RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}, Path=HeadersVisibility, Converter={x:Static DataGrid.HeadersVisibilityConverter}, ConverterParameter={x:Static DataGridHeadersVisibility.Column}}"/>
                                            <ScrollContentPresenter x:Name="PART_ScrollContentPresenter" 
                                                                    Grid.Row="1" 
                                                                    Grid.ColumnSpan="2" 
                                                                    CanContentScroll="{TemplateBinding CanContentScroll}"/>
                                            <ScrollBar x:Name="PART_VerticalScrollBar" 
                                                       Grid.Row="1" 
                                                       Grid.Column="2" 
                                                       Maximum="{TemplateBinding ScrollableHeight}" 
                                                       Value="{Binding VerticalOffset, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}" 
                                                       Orientation="Vertical" 
                                                       ViewportSize="{TemplateBinding ViewportHeight}"/>
                                            <ScrollBar x:Name="PART_HorizontalScrollBar" 
                                                       Grid.Row="2" 
                                                       Grid.Column="1" 
                                                       Maximum="{TemplateBinding ScrollableWidth}" 
                                                       Value="{Binding HorizontalOffset, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}" 
                                                       Orientation="Horizontal" 
                                                       ViewportSize="{TemplateBinding ViewportWidth}"/>
                                        </Grid>
                                    </ControlTemplate>
                                </ScrollViewer.Template>
                                <ItemsPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="ColumnHeaderStyle">
                <Setter.Value>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#F9FAFB"/>
                        <Setter Property="Foreground" Value="#6B7280"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="BorderThickness" Value="0,0,1,1"/>
                        <Setter Property="BorderBrush" Value="#E5E7EB"/>
                        <Setter Property="Padding" Value="12"/>
                        <Setter Property="FontSize" Value="13"/>
                        <Setter Property="HorizontalContentAlignment" Value="Left"/>
                    </Style>
                </Setter.Value>
            </Setter>
            <Setter Property="CellStyle">
                <Setter.Value>
                    <Style TargetType="DataGridCell">
                        <Setter Property="BorderThickness" Value="0,0,1,0"/>
                        <Setter Property="BorderBrush" Value="#F3F4F6"/>
                        <Setter Property="Padding" Value="12"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="DataGridCell">
                                    <Border Background="{TemplateBinding Background}" 
                                            BorderBrush="{TemplateBinding BorderBrush}" 
                                            BorderThickness="{TemplateBinding BorderThickness}">
                                        <ContentPresenter/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#EEF2FF"/>
                                <Setter Property="Foreground" Value="#4F46E5"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ListBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBox">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8">
                            <ScrollViewer HorizontalScrollBarVisibility="Disabled">
                                <ItemsPresenter/>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ListBoxItem">
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="{TemplateBinding Background}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#EEF2FF"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F9FAFB"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ProgressBar">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Border Background="#F3F4F6" 
                                BorderThickness="0" 
                                CornerRadius="4"
                                Height="8">
                            <Grid x:Name="PART_Track">
                                <Rectangle x:Name="PART_Indicator" 
                                           Fill="#4F46E5" 
                                           RadiusX="4" 
                                           RadiusY="4" />
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <GroupBox Header="输入文件" Grid.Row="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,12">
                    <Button x:Name="AddFilesButton" Content="选择文件" Click="AddFiles_Click"/>
                    <Button x:Name="AddFolderButton" Content="选择文件夹" Click="AddFolder_Click"/>
                    <Button x:Name="RemoveSelectedButton" Content="移除选中" Click="RemoveSelected_Click"/>
                    <Button x:Name="ClearInputButton" Content="清空" Click="ClearInput_Click"/>
                    <Button x:Name="SettingsButton" Content="设置" Click="SettingsButton_Click" Background="#6B7280"/>
                </StackPanel>
                <ListBox x:Name="InputList" Grid.Row="1" Height="140" SelectionMode="Extended">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="8">
                                <DockPanel LastChildFill="True">
                                    <TextBlock Text="{Binding Type}" Width="70" Foreground="#6B7280" FontWeight="Medium" FontSize="13"/>
                                    <TextBlock Text="{Binding Path}" TextTrimming="CharacterEllipsis" Foreground="#374151" FontSize="13"/>
                                </DockPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </GroupBox>
        
        <GroupBox Header="搜索关键词" Grid.Row="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="关键词（逗号分隔）：" VerticalAlignment="Center" Margin="0,0,12,0" FontSize="14" Foreground="#6B7280"/>
                <TextBox x:Name="KeywordsTextBox" Grid.Column="1" Height="42" Text="预埋件,HILTI" FontSize="14"/>
            </Grid>
        </GroupBox>
        
        <GroupBox Header="操作控制" Grid.Row="2">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,16">
                    <Button x:Name="StartButton" Content="开始扫描" Click="Start_Click" Background="#10B981"/>
                    <Button x:Name="CancelButton" Content="取消" IsEnabled="False" Click="Cancel_Click" Background="#EF4444"/>
                    <Button x:Name="ExportCsvButton" Content="导出 CSV" IsEnabled="False" Click="ExportCsv_Click" Background="#F59E0B"/>
                    <Button x:Name="ExportXlsxButton" Content="导出 Excel" IsEnabled="False" Click="ExportXlsx_Click" Background="#3B82F6"/>
                </StackPanel>
                <Grid Grid.Row="1" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="100"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="比对进度：" VerticalAlignment="Center" Margin="0,0,12,0" FontSize="14" Foreground="#6B7280"/>
                    <ProgressBar x:Name="CompareProgressBar" Grid.Column="1" Height="8" Minimum="0" Maximum="100" Value="0"/>
                    <TextBlock x:Name="CompareProgressText" Grid.Column="2" Margin="12,0,0,0" VerticalAlignment="Center" TextAlignment="Right" FontSize="13" Foreground="#6B7280"/>
                </Grid>
                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="100"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="转换/扫描：" VerticalAlignment="Center" Margin="0,0,12,0" FontSize="14" Foreground="#6B7280"/>
                    <ProgressBar x:Name="ProgressBar" Grid.Column="1" Height="8" Minimum="0" Maximum="100" Value="0"/>
                    <TextBlock x:Name="ProgressText" Grid.Column="2" Margin="12,0,0,0" VerticalAlignment="Center" TextAlignment="Right" FontSize="13" Foreground="#6B7280"/>
                </Grid>
            </Grid>
        </GroupBox>
        
        <GroupBox Header="结果筛选" Grid.Row="3">
            <WrapPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,16,8">
                    <TextBlock Text="文件：" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="14" Foreground="#6B7280"/>
                    <ComboBox x:Name="FileFilterCombo" Width="180" SelectionChanged="FilterChanged"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,16,8">
                    <TextBlock Text="类型：" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="14" Foreground="#6B7280"/>
                    <ComboBox x:Name="TypeFilterCombo" Width="160" SelectionChanged="FilterChanged"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,16,8">
                    <TextBlock Text="图层：" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="14" Foreground="#6B7280"/>
                    <ComboBox x:Name="LayerFilterCombo" Width="160" SelectionChanged="FilterChanged"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,16,8">
                    <TextBlock Text="关键字：" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="14" Foreground="#6B7280"/>
                    <ComboBox x:Name="KeywordFilterCombo" Width="160" SelectionChanged="FilterChanged"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="内容包含：" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="14" Foreground="#6B7280"/>
                    <TextBox x:Name="ContentFilterTextBox" Width="220" TextChanged="ContentFilterTextBox_TextChanged"/>
                </StackPanel>
            </WrapPanel>
        </GroupBox>
        
        <GroupBox Header="搜索结果" Grid.Row="4">
            <DockPanel>
                <TextBlock x:Name="StatsText" DockPanel.Dock="Top" Margin="0,0,0,12" FontSize="15" FontWeight="SemiBold" Foreground="#1F2937"/>
                <DataGrid x:Name="ResultsGrid" AutoGenerateColumns="False" IsReadOnly="True"
                          EnableRowVirtualization="True" EnableColumnVirtualization="True">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="文件名" Width="220">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock>
                                        <Hyperlink Click="OpenDwgLink_Click" ToolTip="{Binding DwgPath}" Foreground="#4F46E5">
                                            <Run Text="{Binding FileName}"/>
                                        </Hyperlink>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="对象类型" Binding="{Binding ObjectType}" Width="130"/>
                        <DataGridTextColumn Header="图层" Binding="{Binding Layer}" Width="130"/>
                        <DataGridTextColumn Header="关键字" Binding="{Binding Keyword}" Width="130"/>
                        <DataGridTextColumn Header="匹配内容" Binding="{Binding Content}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </GroupBox>
        
        <GroupBox Header="运行日志" Grid.Row="5" Margin="0,0,0,0">
            <ListBox x:Name="LogList" Height="140">
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Padding" Value="8,6"/>
                        <Setter Property="FontFamily" Value="Consolas"/>
                        <Setter Property="FontSize" Value="12"/>
                        <Setter Property="Foreground" Value="#6B7280"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F9FAFB"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </GroupBox>
    </Grid>
</Window>
