<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŠå…¬è‡ªåŠ¨åŒ–å·¥å…·ç®±</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="animations.css">
  <meta name="theme-color" content="#2196F3">
  <style>
    .tool-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .tool-btn-select {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      user-select: none;
    }

    .tool-btn-select:hover {
      border-color: var(--primary-color);
      transform: translateY(-2px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .tool-btn-select.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .tool-btn-select .icon {
      font-size: 20px;
      margin-bottom: 5px;
    }

    .tool-btn-select .name {
      font-size: 12px;
      line-height: 1.3;
    }

    .modal-close-btn {
      border: none;
      background: transparent;
      font-size: 28px;
      line-height: 1;
      cursor: pointer;
      color: var(--text-primary, #555);
      opacity: 0.6;
      transition: all 0.2s;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }

    .modal-close-btn:hover {
      opacity: 1;
      background-color: rgba(0, 0, 0, 0.05);
      /* Light gray hover */
    }
  </style>
</head>

<body data-theme="light">
  <header>
    <div class="container">
      <div class="header-content">
        <h1>åŠå…¬è‡ªåŠ¨åŒ–å·¥å…·ç®±</h1>
        <div class="settings">
          <label>ä¸»é¢˜æ¨¡å¼ï¼š</label>
          <select id="bgColorSelector">
            <option value="light">ğŸŒ æµ…è‰²æ¨¡å¼</option>
            <option value="dark">ğŸŒ™ æ·±è‰²æ¨¡å¼</option>
            <option value="auto">ğŸ”„ è‡ªåŠ¨åˆ‡æ¢</option>
          </select>
        </div>
      </div>
    </div>
  </header>

  <nav>
    <div class="container">
      <div class="tab-container">
        <button class="tab-btn active" data-tab="dwg">ğŸ“ DWG å·¥å…·</button>
        <button class="tab-btn" data-tab="excel">ğŸ“Š Excel å·¥å…·</button>
        <button class="tab-btn" data-tab="word">ğŸ“ Word å·¥å…·</button>
      </div>
    </div>
  </nav>

  <main>
    <div class="container">
      <!-- DWG å·¥å…·é›†åˆ -->
      <section id="dwg" class="tab-content active">
        <div class="tool-card">
          <h2>ğŸ“ DWG å·¥å…·é›†</h2>
          <div class="subtools">
            <button class="subtab-btn active" data-sub="dxfSearch">ğŸ” DXF å…³é”®å­—æŸ¥æ‰¾</button>
            <button class="subtab-btn" data-sub="dxfValve">ğŸ” DXF é˜€é—¨é£å£ä¿¡æ¯ç»Ÿè®¡</button>
            <button class="subtab-btn" data-sub="dxfReplace">ğŸ”„ DWG å›¾çº¸æ–‡å­—å†…å®¹æ›¿æ¢</button>
          </div>

          <div id="dxfSearch" class="subtab-content active">
            <h3>ğŸ” DXF å…³é”®å­—æŸ¥æ‰¾</h3>
            <div id="dropZone">ğŸ“ å°† DXF æ–‡ä»¶æ‹–æ‹½åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
            <input type="file" id="fileInput" multiple accept=".dxf" webkitdirectory directory style="display: none;">

            <!-- ğŸ“ æ–‡ä»¶åˆ—è¡¨åŒºåŸŸ -->
            <div id="fileList" class="file-list" style="display: none;">
              <div class="file-summary">
                <h4>ğŸ“ å·²å¯¼å…¥æ–‡ä»¶ (<span id="fileCount">0</span> ä¸ª)</h4>
                <button id="clearFiles" class="clear-btn">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶</button>
              </div>
              <div id="fileGrid" class="file-grid"></div>
            </div>
            <div style="margin-bottom: 20px;">
              <label>ğŸ”‘ å…³é”®å­—ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼š</label>
              <input type="text" id="keywords" value="é¢„åŸ‹ä»¶,HILTI" placeholder="è¾“å…¥å…³é”®å­—ï¼Œç”¨é€—å·åˆ†éš”">
            </div>
            <div style="margin-bottom: 20px;">
              <button id="scanBtn">ğŸš€ å¼€å§‹æ‰«æ</button>
              <button id="exportCSV" disabled>ğŸ“Š å¯¼å‡º CSV</button>
              <button id="exportXLSX" disabled>ğŸ“ˆ å¯¼å‡º Excel</button>
              <label style="margin-left:auto;">æ¯é¡µè¡Œæ•°ï¼š
                <select id="resPageSize">
                  <option>10</option>
                  <option>20</option>
                  <option>50</option>
                  <option>100</option>
                </select>
              </label>
              <div>
                <button id="resPrevPage">ä¸Šä¸€é¡µ</button>
                <button id="resNextPage">ä¸‹ä¸€é¡µ</button>
                <span id="resPageInfo" style="margin-left:8px;"></span>
              </div>
            </div>
            <div id="progress"></div>
            <div style="overflow-x: auto;">
              <table id="resultsTable">
                <thead>
                  <tr>
                    <th data-key="æ–‡ä»¶å">ğŸ“„ æ–‡ä»¶å</th>
                    <th data-key="å¯¹è±¡ç±»å‹">ğŸ·ï¸ å¯¹è±¡ç±»å‹</th>
                    <th data-key="å›¾å±‚">ğŸ¨ å›¾å±‚</th>
                    <th data-key="å…³é”®å­—">ğŸ”‘ å…³é”®å­—</th>
                    <th data-key="åŒ¹é…å†…å®¹">ğŸ“ åŒ¹é…å†…å®¹</th>
                  </tr>
                  <tr class="filter-row">
                    <th><select id="resSelectFile">
                        <option value="">å…¨éƒ¨</option>
                      </select></th>
                    <th><select id="resSelectType">
                        <option value="">å…¨éƒ¨</option>
                      </select></th>
                    <th><select id="resSelectLayer">
                        <option value="">å…¨éƒ¨</option>
                      </select></th>
                    <th><select id="resSelectKeyword">
                        <option value="">å…¨éƒ¨</option>
                      </select></th>
                    <th><input id="resFilterContentH" placeholder="ç­›é€‰ å†…å®¹åŒ…å«"></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <!-- =============== DXF é˜€é—¨ä¿¡æ¯ç»Ÿè®¡ =============== -->
          <div id="dxfValve" class="subtab-content">
            <h3>ğŸ§° DXF é˜€é—¨ä¿¡æ¯ç»Ÿè®¡</h3>

            <div id="valveDropZone" class="drop-zone">ğŸ“ å°† DXF æ–‡ä»¶æ‹–æ‹½åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
            <input type="file" id="valveFileInput" multiple accept=".dxf" style="display:none;">

            <div id="valveFileList" class="file-list" style="display:none;">
              <div class="file-summary">
                <h4>ğŸ“ å·²å¯¼å…¥æ–‡ä»¶ (<span id="valveFileCount">0</span> ä¸ª)</h4>
                <button id="valveClearFiles" class="clear-btn">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶</button>
              </div>
              <div id="valveFileGrid" class="file-grid"></div>
            </div>

            <div style="margin-bottom:20px;">
              <button id="valveScanBtn">ğŸš€ å¼€å§‹æå–é˜€é—¨ä¸é£å£ä¿¡æ¯</button>
              <button id="valveExportCSV" disabled>ğŸ“Š å¯¼å‡º CSV</button>
              <button id="valveExportXLSX" disabled>ğŸ“ˆ å¯¼å‡º Excel</button>
            </div>

            <div id="valveProgress"></div>

            <div style="overflow-x:auto;">
              <table id="valveResultsTable">
                <thead>
                  <tr>
                    <th>ğŸ“„ æ–‡ä»¶å</th>
                    <th>ğŸ“Œ ç±»å‹</th>
                    <th>ğŸ· åç§°</th>
                    <th>ğŸ”¢ ç¼–å·</th>
                    <th>ğŸ“ å°ºå¯¸</th>
                    <th>ğŸ“ æ ‡é«˜</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div id="dxfReplace" class="subtab-content">
            <h3>ğŸ”„ DWG å›¾çº¸æ–‡å­—å†…å®¹æ›¿æ¢</h3>
            <div id="repDropZone" class="drop-zone">ğŸ“ å°† DXF æ–‡ä»¶æ‹–æ‹½åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
            <input type="file" id="repFileInput" multiple accept=".dxf" webkitdirectory directory style="display:none;">
            <div class="file-list" id="repFileList" style="display:none;">
              <div class="file-summary">
                <h4>ğŸ“ å·²å¯¼å…¥æ–‡ä»¶ (<span id="repFileCount">0</span> ä¸ª)</h4>
                <button id="repClearFiles" class="clear-btn">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶</button>
              </div>
              <div id="repFileGrid" class="file-grid"></div>
            </div>
            <div style="margin-top:20px;">
              <h4>ğŸ” æ›¿æ¢è§„åˆ™</h4>
              <div id="repPairs"></div>
            </div>
            <div style="margin-top:20px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
              <button id="repScanBtn">ğŸš€ æ‰§è¡Œæ›¿æ¢æ¨¡æ‹Ÿ</button>
              <button id="repConfirmBtn" disabled>âœ… ç¡®è®¤æ‰§è¡Œæ›¿æ¢</button>
              <label style="display:flex;align-items:center;gap:6px;">
                <input type="checkbox" id="repOverwrite">
                ç›´æ¥ä¿å­˜åˆ°æ‰€é€‰ç›®å½•ï¼ˆå¯èƒ½è¦†ç›–æºæ–‡ä»¶ï¼‰
              </label>
              <button id="repExportCSV" disabled>ğŸ“Š å¯¼å‡º CSV</button>
              <button id="repExportXLSX" disabled>ğŸ“ˆ å¯¼å‡º Excel</button>
              <label style="margin-left:auto;">æ¯é¡µè¡Œæ•°ï¼š
                <select id="repPageSize">
                  <option>10</option>
                  <option>20</option>
                  <option>50</option>
                  <option>100</option>
                </select>
              </label>
              <div>
                <button id="repPrevPage">ä¸Šä¸€é¡µ</button>
                <button id="repNextPage">ä¸‹ä¸€é¡µ</button>
                <span id="repPageInfo" style="margin-left:8px;"></span>
              </div>
            </div>
            <div id="repProgress" style="margin-top:10px;"></div>
            <div style="overflow-x:auto; margin-top:10px;">
              <table id="repResultsTable">
                <thead>
                  <tr>
                    <th data-key="æ–‡ä»¶å">ğŸ“„ æ–‡ä»¶å</th>
                    <th data-key="å¯¹è±¡ç±»å‹">ğŸ·ï¸ å¯¹è±¡ç±»å‹</th>
                    <th data-key="å›¾å±‚">ğŸ¨ å›¾å±‚</th>
                    <th data-key="åŸå†…å®¹">ğŸ“ åŸå†…å®¹</th>
                    <th data-key="æ›¿æ¢å">ğŸ“ æ›¿æ¢å</th>
                    <th data-key="ä½¿ç”¨è§„åˆ™">ğŸ”‘ ä½¿ç”¨è§„åˆ™</th>
                  </tr>
                  <tr class="filter-row">
                    <th><select id="repSelectFile">
                        <option value="">å…¨éƒ¨</option>
                      </select></th>
                    <th><select id="repSelectType">
                        <option value="">å…¨éƒ¨</option>
                      </select></th>
                    <th><select id="repSelectLayer">
                        <option value="">å…¨éƒ¨</option>
                      </select></th>
                    <th><input id="repFilterOriginalH" placeholder="ç­›é€‰ åŸå†…å®¹"></th>
                    <th><input id="repFilterUpdatedH" placeholder="ç­›é€‰ æ›¿æ¢å"></th>
                    <th><select id="repSelectRule">
                        <option value="">å…¨éƒ¨</option>
                      </select></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>


      <!-- Excel å·¥å…·é›†åˆ -->
      <section id="excel" class="tab-content">
        <div class="tool-card">
          <h2>ğŸ“Š Excel å·¥å…·é›†</h2>
          <!-- =============== EXCEL MERGE TOOL ================ -->
          <div id="excelMerge" class="subtab-content active"> <!-- Default active for Development/Preview -->
            <h3>ğŸ“Š Excel å¤šåŠŸèƒ½åˆå¹¶å·¥å…·</h3>

            <div id="excelDropZone" class="drop-zone">ğŸ“ å°† Excel æ–‡ä»¶æ‹–æ‹½åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ (.xlsx, .xls)</div>
            <input type="file" id="excelFileInput" multiple accept=".xlsx,.xls,.csv" style="display:none;" />

            <div id="excelFileList" class="file-list" style="display:none;">
              <div class="file-summary">
                <h4>ğŸ“ å·²å‡†å¤‡å¤„ç† (<span id="excelFileCount">0</span> ä¸ª)</h4>
                <button id="excelClearFiles" class="clear-btn">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶</button>
              </div>
              <div id="excelFileGrid" class="file-grid"></div>
            </div>

            <div class="control-panel"
              style="margin-top: 20px; padding: 15px; background: var(--bg-hover); border-radius: 8px;">
              <div class="form-group" style="margin-bottom: 15px;">
                <label style="font-weight:bold; display:block; margin-bottom:10px;">ğŸ› ï¸ é€‰æ‹©åŠŸèƒ½æ¨¡å¼ï¼š</label>

                <div id="excelModeGrid" class="tool-grid">
                  <div class="tool-btn-select active" data-value="merge-workbooks" data-anim-class="anim-wb"
                    data-desc="å°†å¤šä¸ª Excel å·¥ä½œç°¿çš„æ‰€æœ‰å·¥ä½œè¡¨åˆå¹¶åˆ°ä¸€ä¸ªæ–°çš„å·¥ä½œç°¿ä¸­ï¼Œä¿ç•™åŸå·¥ä½œè¡¨ç»“æ„ã€‚">
                    <div class="icon">ğŸ“‚</div>
                    <div class="name">å¤šå·¥ä½œç°¿ -> å·¥ä½œç°¿</div>
                  </div>
                  <div class="tool-btn-select" data-value="merge-to-sheet" data-anim-class="anim-stack"
                    data-desc="å°†å¤šä¸ªå·¥ä½œç°¿/å·¥ä½œè¡¨çš„æ•°æ®ï¼ŒæŒ‰è¡Œæˆ–æŒ‰åˆ—æ±‡æ€»åˆ°åŒä¸€ä¸ªå·¥ä½œè¡¨ä¸­ã€‚">
                    <div class="icon">ğŸ“‘</div>
                    <div class="name">å¤šå·¥ä½œç°¿ -> å·¥ä½œè¡¨</div>
                  </div>
                  <div class="tool-btn-select" data-value="internal-merge" data-anim-class="anim-internal"
                    data-desc="å°†åŒä¸€ä¸ªå·¥ä½œç°¿å†…çš„å¤šä¸ªå·¥ä½œè¡¨ï¼Œåˆå¹¶åˆ°è¯¥å·¥ä½œç°¿çš„ä¸€ä¸ªæ–°Sheetä¸­ã€‚">
                    <div class="icon">ğŸ”„</div>
                    <div class="name">å·¥ä½œç°¿å†…éƒ¨æ±‡æ€»</div>
                  </div>
                  <div class="tool-btn-select" data-value="same-name-sheet" data-anim-class="anim-same"
                    data-desc="ä»å¤šä¸ªæ–‡ä»¶ä¸­æå–åç§°ç›¸åŒçš„å·¥ä½œè¡¨ï¼ˆå¦‚'ä¸€æœˆ'ï¼‰ï¼Œåˆå¹¶åˆ°ç»“æœæ–‡ä»¶çš„å¯¹åº”Sheetä¸­ã€‚">
                    <div class="icon">ğŸ·ï¸</div>
                    <div class="name">åŒåSheetæ±‡æ€»</div>
                  </div>
                  <div class="tool-btn-select" data-value="same-position" data-anim-class="anim-pos"
                    data-desc="ä»å¤šä¸ªæ–‡ä»¶çš„ç›¸åŒä½ç½®ï¼ˆå¦‚ A1ï¼‰æå–æ•°æ®ï¼Œæ±‡æ€»æˆä¸€å¼ æ¸…å•ã€‚">
                    <div class="icon">ğŸ¯</div>
                    <div class="name">æŒ‡å®šä½ç½®/å•å…ƒæ ¼æå–</div>
                  </div>
                  <div class="tool-btn-select" data-value="same-filename" data-anim-class="anim-wb"
                    data-desc="å¤„ç†åŒåæ–‡ä»¶å†²çªï¼Œæˆ–æŒ‰æ–‡ä»¶åå½’ç±»æ±‡æ€»ã€‚">
                    <div class="icon">ğŸ“</div>
                    <div class="name">åŒåæ–‡ä»¶æ±‡æ€»</div>
                  </div>
                  <div class="tool-btn-select" data-value="merge-dynamic" data-anim-class="anim-dyn"
                    data-desc="[å¼€å‘ä¸­] æ™ºèƒ½è¯†åˆ«è¡¨å¤´ï¼ŒæŒ‰å­—æ®µåç§°å¯¹é½åˆå¹¶ï¼Œæ— éœ€åˆ—åºä¸€è‡´ã€‚">
                    <div class="icon">ğŸ§©</div>
                    <div class="name">åˆå¹¶åŠ¨æ€å­—æ®µ</div>
                  </div>
                  <div class="tool-btn-select" data-value="collab-merge" data-anim-class="anim-clb"
                    data-desc="å¤šäººååŒå¡«è¡¨æ¨¡å¼ã€‚è‡ªåŠ¨æ£€æµ‹å¹¶æ ‡è®°ä¸åŒäººå¡«å†™çš„å†…å®¹å†²çªï¼Œç”Ÿæˆå†²çªæŠ¥å‘Šã€‚">
                    <div class="icon">ğŸ¤</div>
                    <div class="name">å¤šäººååŒå†²çªåˆå¹¶</div>
                  </div>
                </div>
                <input type="hidden" id="excelModeSelect" value="merge-workbooks">
              </div>

              <!-- Dynamic Options Rendered Here -->
              <div id="excelOptionsPanel"></div>
            </div>

            <div style="margin-top: 20px; display: flex; align-items: center; gap: 15px;">
              <button id="excelPreviewBtn" class="tool-btn" style="flex: 1; background: #FF9800;">ğŸ‘ï¸ é¢„è§ˆç»“æœ</button>
              <button id="excelProcessBtn" class="tool-btn" style="flex: 2;">ğŸš€ å¼€å§‹å¤„ç†</button>
              <span id="excelProgress" style="font-size: 14px; color: var(--text-secondary);"></span>
            </div>
          </div>
        </div>
    </div>
    </section>

    <!-- Preview Modal -->
    <div id="previewModal" class="modal"
      style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000;">
      <div class="modal-content"
        style="position:relative; background:var(--bg-card, #fff); color:var(--text-primary, #333); margin:5% auto; padding:20px; width:90%; height:80%; overflow:hidden; border-radius:8px; display:flex; flex-direction:column; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <h3 style="margin:0;">ğŸ“Š ç»“æœé¢„è§ˆ (å‰50è¡Œ)</h3>
          <button onclick="document.getElementById('previewModal').style.display='none'"
            class="modal-close-btn">&times;</button>
        </div>
        <div id="previewTabs" style="display:flex; gap:5px; margin-bottom:10px; overflow-x:auto; padding-bottom:5px;">
        </div>
        <div id="previewContainer"
          style="flex:1; overflow:auto; border:1px solid var(--border-color, #eee); padding:10px;"></div>
        <div style="margin-top:10px; text-align:right;">
          <button onclick="document.getElementById('previewModal').style.display='none'"
            style="padding:8px 20px; border:1px solid var(--border-color, #ccc); background:var(--bg-hover, #f5f5f5); color:var(--text-primary, #333); border-radius:4px; cursor:pointer;">å…³é—­</button>
        </div>
      </div>
    </div>

    <!-- Word å·¥å…·é›†åˆ -->
    <section id="word" class="tab-content">
      <div class="tool-card">
        <h2>ğŸ“ Word å·¥å…·é›†</h2>
        <div class="placeholder-card">
          <div class="placeholder-icon">ğŸ“„</div>
          <p>Word æ ¼å¼æ–‡æœ¬è®¾ç½®åŠŸèƒ½ï¼ˆå¼€å‘ä¸­ï¼‰</p>
        </div>
      </div>
    </section>
    </div>
  </main>

  <!-- Animated Tooltip Container -->
  <div id="animTooltip">
    <div class="anim-stage" id="animStage"></div>
    <div class="anim-desc" id="animDesc"></div>
  </div>

  <script src="dxf-parser.min.js"></script>
  <script src="app.js"></script>
  <script src="dxf_search.js"></script>
  <script src="replace.js"></script>
  <script src="excel_merge.js"></script>
</body>

</html>