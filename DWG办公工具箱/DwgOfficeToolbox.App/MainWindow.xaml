<Window x:Class="DwgOfficeToolbox.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DwgOfficeToolbox.App"
        mc:Ignorable="d"
        Title="DWG 批量文字查找" Height="900" Width="1300">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <GroupBox Header="输入" Grid.Row="0" Margin="0,0,0,8">
            <Grid Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,6">
                    <Button x:Name="AddFilesButton" Content="选择文件" Width="90" Margin="0,0,6,0" Click="AddFiles_Click"/>
                    <Button x:Name="AddFolderButton" Content="选择文件夹" Width="110" Margin="0,0,6,0" Click="AddFolder_Click"/>
                    <Button x:Name="RemoveSelectedButton" Content="移除选中" Width="90" Margin="0,0,6,0" Click="RemoveSelected_Click"/>
                    <Button x:Name="ClearInputButton" Content="清空" Width="60" Click="ClearInput_Click"/>
                </StackPanel>
                <ListBox x:Name="InputList" Grid.Row="1" Height="120" SelectionMode="Extended">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <DockPanel LastChildFill="True">
                                <TextBlock Text="{Binding Type}" Width="60" Foreground="Gray"/>
                                <TextBlock Text="{Binding Path}" TextTrimming="CharacterEllipsis"/>
                            </DockPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </GroupBox>

        <GroupBox Header="关键词" Grid.Row="1" Margin="0,0,0,8">
            <Grid Margin="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="逗号分隔：" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <TextBox x:Name="KeywordsTextBox" Grid.Column="1" Height="26" Text="预埋件,HILTI"/>
            </Grid>
        </GroupBox>

        <GroupBox Header="控制与进度" Grid.Row="2" Margin="0,0,0,8">
            <Grid Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,6">
                    <Button x:Name="StartButton" Content="开始扫描" Width="90" Margin="0,0,6,0" Click="Start_Click"/>
                    <Button x:Name="CancelButton" Content="取消" Width="60" Margin="0,0,6,0" IsEnabled="False" Click="Cancel_Click"/>
                    <Button x:Name="ExportCsvButton" Content="导出 CSV" Width="90" Margin="0,0,6,0" IsEnabled="False" Click="ExportCsv_Click"/>
                    <Button x:Name="ExportXlsxButton" Content="导出 Excel" Width="100" IsEnabled="False" Click="ExportXlsx_Click"/>
                </StackPanel>
                <StackPanel Grid.Row="1" Orientation="Vertical">
                    <Grid Margin="0,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="比对进度：" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ProgressBar x:Name="CompareProgressBar" Grid.Column="1" Height="16" Minimum="0" Maximum="100" Value="0"/>
                        <TextBlock x:Name="CompareProgressText" Grid.Column="2" Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </Grid>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="转换/扫描：" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ProgressBar x:Name="ProgressBar" Grid.Column="1" Height="16" Minimum="0" Maximum="100" Value="0"/>
                        <TextBlock x:Name="ProgressText" Grid.Column="2" Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </Grid>
                </StackPanel>
            </Grid>
        </GroupBox>

        <GroupBox Header="筛选" Grid.Row="3" Margin="0,0,0,8">
            <WrapPanel Margin="8">
                <StackPanel Orientation="Horizontal" Margin="0,0,12,6">
                    <TextBlock Text="文件：" VerticalAlignment="Center"/>
                    <ComboBox x:Name="FileFilterCombo" Width="160" Margin="4,0,0,0" SelectionChanged="FilterChanged"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,12,6">
                    <TextBlock Text="类型：" VerticalAlignment="Center"/>
                    <ComboBox x:Name="TypeFilterCombo" Width="140" Margin="4,0,0,0" SelectionChanged="FilterChanged"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,12,6">
                    <TextBlock Text="图层：" VerticalAlignment="Center"/>
                    <ComboBox x:Name="LayerFilterCombo" Width="140" Margin="4,0,0,0" SelectionChanged="FilterChanged"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,12,6">
                    <TextBlock Text="关键字：" VerticalAlignment="Center"/>
                    <ComboBox x:Name="KeywordFilterCombo" Width="140" Margin="4,0,0,0" SelectionChanged="FilterChanged"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,12,6">
                    <TextBlock Text="内容包含：" VerticalAlignment="Center"/>
                    <TextBox x:Name="ContentFilterTextBox" Width="200" Margin="4,0,0,0" TextChanged="ContentFilterTextBox_TextChanged"/>
                </StackPanel>
            </WrapPanel>
        </GroupBox>

        <GroupBox Header="结果" Grid.Row="4">
            <DockPanel Margin="8">
                <TextBlock x:Name="StatsText" DockPanel.Dock="Top" Margin="0,0,0,6"/>
                <DataGrid x:Name="ResultsGrid" AutoGenerateColumns="False" IsReadOnly="True"
                          EnableRowVirtualization="True" EnableColumnVirtualization="True">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="文件名" Width="200">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock>
                                        <Hyperlink Click="OpenDwgLink_Click" ToolTip="{Binding DwgPath}">
                                            <Run Text="{Binding FileName}"/>
                                        </Hyperlink>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="对象类型" Binding="{Binding ObjectType}" Width="120"/>
                        <DataGridTextColumn Header="图层" Binding="{Binding Layer}" Width="120"/>
                        <DataGridTextColumn Header="关键字" Binding="{Binding Keyword}" Width="120"/>
                        <DataGridTextColumn Header="匹配内容" Binding="{Binding Content}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </GroupBox>

        <GroupBox Header="日志" Grid.Row="5" Margin="0,8,0,0">
            <ListBox x:Name="LogList" Height="120" Margin="8"/>
        </GroupBox>
    </Grid>
</Window>
